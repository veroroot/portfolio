name: Build and Deploy with PDF

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 1) Install LaTeX + Pandoc
      - name: Install LaTeX and dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            pandoc \
            texlive \
            texlive-latex-recommended \
            texlive-fonts-recommended \
            texlive-luatex \
            texlive-xetex \
            lmodern \
            fonts-noto \
            fonts-noto-cjk \
            fonts-noto-color-emoji

      # 2) Create PDF folder
      - name: Prepare public folder
        run: mkdir -p public

      # 3) Convert README.md → PDF (Unicode + Emoji + Images 지원)
      - name: Generate PDF from README.md
        run: |
          pandoc README.md \
            --from markdown \
            --resource-path=".:./assets" \
            --pdf-engine=lualatex \
            -V mainfont="Noto Sans CJK KR" \
            -V fallbackfonts="Noto Color Emoji" \
            -V monofont="Noto Sans Mono CJK KR" \
            -o public/portfolio.pdf

      # 4) Copy README as index.md (Pages 웹사이트용)
      - name: Build GitHub Pages site
        run: |
          mkdir -p public
          cp README.md public/index.md
          echo "theme: jekyll-theme-minimal" > public/_config.yml
          touch public/.nojekyll

      # 5) Upload artifact for GitHub Pages
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: public

  deploy:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
